filter {
  if [source_ip] {
    if !([source_ip] =~ "10\." or [source_ip] =~ "192\.168\." or [source_ip] =~ "172\.(1[6-9]|2[0-9]|3[0-1])\." or [source_ip] =~ "fe80::20c:29ff:fe19:f7d" or [source_ip] =~ "::1") {
      geoip {
        source => "[source_ip]"
        target => "source_geo"
      }
    }
    mutate {
      add_field => { "ips" => "%{source_ip}" }
      add_field => { "source_ips" => [ "%{source_ip}" ] }
    }
  }

  if [destination_ip] {
    if !([destination_ip] =~ "10\." or [destination_ip] =~ "192\.168\." or [destination_ip] =~ "172\.(1[6-9]|2[0-9]|3[0-1])\." or [destination_ip] =~ "239.255.255.250" or [destination_ip] =~ "224\.0\.0\." or [destination_ip] =~ "255.255.255.255" or [destination_ip] =~ "ff02::fb" or [destination_ip] =~ "fe80::20c:29ff:fe19:f7d" or [destination_ip] =~ "224\.0\.1\.") {
      geoip {
        source => "[destination_ip]"
        target => "destination_geo"
      }
    }
    mutate {
      add_field => { "ips" => "%{destination_ip}" }
      add_field => { "destination_ips" => [ "%{destination_ip}" ] }
    }
  }
}
