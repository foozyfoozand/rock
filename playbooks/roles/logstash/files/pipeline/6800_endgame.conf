filter {
  if [type] == "endgame" {
    date {
      match => [ "timestamp", "ISO8601" ]
    }

    mutate {
      remove_field => [ "timestamp" ]
      rename => { "local_address" => "source_ip" }
      rename => { "local_port" => "source_port" }
      rename => { "remote_address" => "destination_ip" }
      rename => { "remote_port" => "destination_port" }

      # The following renames are to avoid type conflicts with other logstash outputs
      rename => { "sid" => "security_id" }
      rename => { "enabled" => "is_enabled" }
      rename => { "size" => "total_bytes" }
      rename => { "endpoint" => "endgame_endpoint" }
    }

    # ES can't handle this format of an IPv6 address
    if [source_ip] == "[::]" {
      mutate {
        replace => { "source_ip" => "0.0.0.0" }
      }
    }
    if [source_ip] == "[::1]" {
      mutate {
        replace => { "source_ip" => "127.0.0.1" }
      }
    }
    if [destination_ip] == "[::]" {
      mutate {
        replace => { "destination_ip" => "0.0.0.0" }
      }
    }
    if [destination_ip] == "[::1]" {
      mutate {
        replace => { "destination_ip" => "127.0.0.1" }
      }
    }

    if [hashes] {
      mutate {
        rename => { "[hashes][md5]" => "md5" }
        rename => { "[hashes][sha1]" => "sha1" }
        rename => { "[hashes][sha256]" => "sha256" }
        remove_field => [ "hashes" ]
      }
    }
    if [meta_data][hashes] {
      mutate {
        rename => { "[meta_data][hashes][md5]" => "md5" }
        rename => { "[meta_data][hashes][sha1]" => "sha1" }
        rename => { "[meta_data][hashes][sha256]" => "sha256" }
        remove_field => [ "[meta_data][hashes]" ]
      }
    }
  }
}
